---
title: static 关键字
date: 2025-11-21 11:35:49
categories: 编程语言
tags: C++
---

> 在 C++ 中，`static` 是一个非常重要的关键字，主要用于控制变量和函数的生命周期、作用域以及链接性。`static` 的使用可以影响变量和函数的可见性、存活时间以及作用范围，广泛应用于全局静态变量、局部静态变量、类的静态成员等场景。

## 全局静态变量

全局静态变量是在函数外部（全局作用域）声明的变量，使用 `static` 关键字修饰的。全局静态变量的作用域被限制在定义它的文件中，这意味着它不能在文件外部访问（与普通全局变量不同，后者可以被其他文件访问）。

### 用法

```cpp
static int counter = 0;  // 全局静态变量

void increment() {
    counter++;  // 在该文件中可以访问
}
```

### 生命周期和作用域

- **生命周期**：全局静态变量的生命周期与程序的整个运行周期相同，它在程序启动时被初始化，在程序退出时销毁。
- **作用域**：全局静态变量的作用域仅限于当前源文件（.cpp 文件）。它不能被其他源文件中的代码访问。

## 局部静态变量

局部静态变量是在函数内部声明的变量，使用 `static` 关键字修饰。与普通的局部变量不同，局部静态变量的值不会在函数退出时丢失，而是保持其上次调用时的状态。

### 用法

```cpp
void counterFunction() {
    static int counter = 0;  // 局部静态变量
    counter++;
    std::cout << "Counter: " << counter << std::endl;
}

int main() {
    counterFunction();  // 输出 Counter: 1
    counterFunction();  // 输出 Counter: 2
    counterFunction();  // 输出 Counter: 3
    return 0;
}
```

### 生命周期和作用域

- **生命周期**：局部静态变量的生命周期是整个程序运行周期，它在第一次调用函数时初始化，并且在函数返回时不会销毁，保持其状态直到程序退出。
- **作用域**：局部静态变量的作用域仅限于函数内部，它只能在定义它的函数内访问。如果函数多次调用，静态变量在不同调用之间保持其值。

## 类的静态成员变量

类的静态成员变量是属于类而不是类的对象的变量。所有类的对象共享同一个静态成员变量。静态成员变量通常用于需要跨所有对象共享某些数据的场景。

### 用法

```cpp
class MyClass {
public:
    static int count;  // 静态成员变量

    MyClass() {
        count++;  // 每创建一个对象，count 增加
    }
};

int MyClass::count = 0;  // 定义静态成员变量

int main() {
    MyClass obj1;
    MyClass obj2;
    std::cout << "Object count: " << MyClass::count << std::endl;  // 输出 2
    return 0;
}
```

### 生命周期和作用域

- **生命周期**：静态成员变量的生命周期与程序的整个运行周期相同。它在程序启动时初始化（静态成员变量在类外定义并初始化），在程序退出时销毁。
- **作用域**：静态成员变量的作用域是整个类。它属于类本身，而不是类的对象。类的静态成员变量不需要通过对象来访问，可以通过 `类名::变量名` 直接访问。

## 类的静态成员函数

类的静态成员函数与静态成员变量类似。它是属于类的，而不是类的对象的函数。静态成员函数不能访问类的非静态成员变量和非静态成员函数，但可以访问类的静态成员。

### 用法

```cpp
class MyClass {
public:
    static int count;

    MyClass() {
        count++;
    }

    static void printCount() {  // 静态成员函数
        std::cout << "Count: " << count << std::endl;
    }
};

int MyClass::count = 0;

int main() {
    MyClass obj1;
    MyClass obj2;
    MyClass::printCount();  // 可以直接通过类名调用静态成员函数
    return 0;
}
```

### 生命周期和作用域

- **生命周期**：静态成员函数的生命周期与类的生命周期相同，它在类加载时创建，在程序结束时销毁。
- **作用域**：静态成员函数的作用域仅限于类内部。它可以通过 `类名::函数名` 或者通过对象来调用，但它不能访问类的非静态成员（即，无法访问非静态数据成员和非静态成员函数）。静态成员函数只能访问静态成员。

## static 修饰函数

当 `static` 用于函数时，表示该函数的作用域仅限于当前文件。这通常用于防止函数的名称污染全局命名空间，确保该函数仅在当前源文件中可见。

### 用法

```cpp
static void helperFunction() {
    std::cout << "This is a static function" << std::endl;
}

int main() {
    helperFunction();  // 可以在同一文件中调用
    return 0;
}
```

### 生命周期和作用域

- **生命周期**：`static` 修饰的函数在程序运行时存在，直到程序退出。它与常规函数的生命周期相同。
- **作用域**：该函数的作用域仅限于声明它的文件，在文件外部无法访问。

## 总结

- **全局静态变量**：
    - **生命周期**：程序的整个运行周期。
    - **作用域**：仅限于当前源文件，其他文件无法访问。
- **局部静态变量**：
    - **生命周期**：程序的整个运行周期，但只在第一次调用函数时初始化，且跨函数调用保持其值。
    - **作用域**：仅限于函数内部，外部不可访问。
- **类的静态成员变量**：
    - **生命周期**：程序的整个运行周期。
    - **作用域**：跨所有类的对象共享，可以通过 `类名::成员` 直接访问。
- **类的静态成员函数**：
    - **生命周期**：程序的整个运行周期。
    - **作用域**：属于类本身，可以通过 `类名::函数` 直接访问，但不能访问类的非静态成员。
- **`static` 修饰函数**：
    - **生命周期**：程序的整个运行周期。
    - **作用域**：仅限于当前源文件，外部无法访问。
